<template>
  <div>
    <svg
      ref="svgElement"
      :width="width"
      :height="height"
      viewBox="0 0 705 530"
      xmlns="http://www.w3.org/2000/svg"
      @mousedown="startAction"
      @mousemove="performAction"
      @mouseup="stopAction"
      @touchstart.prevent="startAction"
      @touchmove.prevent="performAction"
      @touchend="stopAction"
      @touchcancel="stopAction"
    >
      <g ref="dogSvg">
        <path
          ref="dogPath"
          d="M96.9279 517.567L96.9078 517.557C98.0878 520.587 94.3279 523.127 91.1879 523.997C78.9079 527.407 65.4378 526.367 53.8278 521.117C49.3878 519.117 45.1579 516.467 41.9679 512.787C39.3979 509.827 37.7178 506.287 36.8678 502.537C31.4378 495.417 24.7779 368.307 30.7479 318.647C31.3079 313.967 31.9678 309.197 33.6378 304.817C34.1378 297.267 35.4178 289.797 37.8778 282.597C37.9578 282.357 38.0478 282.107 38.1278 281.867C27.8578 275.107 19.6178 264.977 14.1578 253.837C6.07784 237.347 3.34787 218.757 1.93787 200.437C-0.27213 171.847 0.687889 142.037 12.9579 116.117C14.3779 113.137 17.9178 109.767 20.3478 111.997C19.7478 137.007 19.9877 162.977 30.5577 185.647C39.3977 204.637 56.8477 223.647 77.8077 227.967C81.0877 228.647 84.2479 229.707 87.1679 231.117C96.5779 226.447 106.628 222.867 116.818 220.447C151.548 212.197 188.028 215.177 223.718 218.177C225.438 218.327 227.158 218.467 228.888 218.617C281.818 215.317 334.468 189.807 354.848 162.567C411.178 87.2874 504.038 39.7874 553.818 44.7974C556.108 45.0274 558.318 45.3674 560.428 45.8274C560.888 44.8474 561.408 43.9175 561.988 43.0275C566.638 35.8675 574.808 31.3675 582.858 28.1175C596.758 22.4975 609.678 13.2474 623.128 7.78739C626.798 2.93739 638.478 1.54748 644.258 1.12748C654.918 0.347477 666.228 3.10747 673.938 10.4975C682.998 19.1775 685.688 32.5075 686.718 45.0175C687.658 56.4375 687.478 68.4775 682.108 78.5975C680.138 82.3375 676.588 86.0974 672.418 85.4174C667.698 84.6474 665.808 78.9775 664.928 74.2675C663.508 66.6275 662.248 58.9075 660.358 51.3775C649.928 64.5975 637.428 76.0974 624.778 87.1674C623.788 88.0274 622.818 88.8374 621.848 89.5874C624.208 96.0974 626.218 102.908 628.088 109.778C641.908 108.888 657.458 107.657 670.818 110.097C676.158 110.027 681.448 112.417 685.618 115.647C690.298 119.267 693.898 124.117 696.938 129.197C700.078 134.437 702.718 140.097 703.628 146.137C704.548 152.177 703.588 158.677 700.058 163.667C695.828 169.647 677.628 184.487 668.308 176.317C663.748 172.317 666.598 165.657 666.818 164.997C669.518 156.887 673.028 149.737 675.848 141.947C675.488 142.207 675.128 142.467 674.768 142.727C664.818 149.717 654.008 155.487 642.658 159.857C659.238 205.427 684.218 248.817 684.978 296.927C685.028 300.727 684.678 304.487 684.138 308.217C683.438 313.117 682.408 317.957 681.558 322.747C672.608 373.517 613.258 375.937 601.308 378.557C576.168 384.067 548.978 376.887 526.698 361.377C526.698 361.377 527.128 362.117 520.558 356.817C520.508 356.777 520.448 356.727 520.398 356.687C517.168 354.077 511.018 348.477 511.018 348.477C496.078 334.127 483.958 316.057 475.028 296.537C471.678 289.227 468.778 281.687 466.318 273.997L465.608 275.107L451.728 317.947C448.638 328.107 445.118 338.137 441.268 348.017C438.248 355.757 434.988 363.467 431.178 370.897C427.648 386.067 418.568 402.617 413.888 415.687C406.368 436.667 398.858 457.657 391.348 478.627C401.058 483.137 409.468 488.827 411.548 501.127C412.388 506.127 411.818 511.567 408.908 515.727C407.258 518.087 404.748 519.897 402.008 520.717C401.828 520.767 401.658 520.817 401.488 520.857C401.018 520.947 400.298 521.067 399.608 521.167C398.758 521.297 397.958 521.398 397.778 521.388C396.618 521.358 396.068 521.277 395.648 520.677L395.628 520.667C396.808 523.697 393.048 526.237 389.918 527.107C377.628 530.517 364.168 529.477 352.548 524.237C348.108 522.227 343.888 519.578 340.698 515.908C340.268 515.418 339.868 514.908 339.488 514.388C329.558 516.508 319.028 515.877 309.448 512.487C304.868 510.857 300.428 508.577 296.948 505.177C292.388 500.737 290.038 494.607 289.748 488.287C289.358 487.007 289.008 485.717 288.658 484.437C286.518 476.637 284.378 468.827 282.238 461.027C281.348 457.777 280.448 454.517 279.578 451.247V451.237C268.098 452.277 256.558 452.777 245.028 452.717C218.928 452.577 192.828 449.627 167.438 443.917C165.158 448.107 163.158 452.437 161.538 456.937C174.158 462.287 186.798 467.297 189.408 482.767C190.258 487.777 189.688 493.217 186.778 497.367C185.118 499.727 182.608 501.547 179.868 502.367C179.718 502.407 179.568 502.457 179.418 502.487C178.948 502.587 178.178 502.717 177.448 502.817C176.128 502.917 174.788 502.767 173.518 502.337C173.508 502.327 173.498 502.327 173.488 502.317C174.668 505.347 170.908 507.887 167.778 508.757C155.498 512.167 142.028 511.127 130.408 505.877C125.978 503.877 121.748 501.227 118.558 497.547C115.988 494.587 114.308 491.057 113.458 487.297C111.308 484.477 108.968 462.867 107.298 434.707C98.4077 446.377 89.8779 458.467 84.9479 472.177C97.5779 477.527 110.208 482.537 112.828 498.017C113.668 503.017 113.098 508.457 110.188 512.607C108.528 514.977 106.018 516.787 103.278 517.607C103.108 517.657 102.938 517.707 102.778 517.747C102.308 517.837 101.578 517.957 100.888 518.057C99.5578 518.157 98.2179 518.017 96.9279 517.567Z"
        />

        <g transform="matrix(1,0,0,1,-1835.69,-549.889)">
          <g transform="matrix(1,0,0,1,-15.2789,4.43357)">
            <path
              d="M2365.52,742.477C2338.97,782.715 2297.75,847.761 2271.21,888C2263.32,899.952 2269.77,887.437 2257.62,895.138C2249.08,900.549 2239.06,903.366 2229,905.214C2220.17,906.837 2211.04,907.762 2202.1,906.163C2192.12,904.376 2182.9,899.544 2174.09,894.408C2149.76,880.211 2126.14,862.013 2114.37,836.673C2112.96,833.646 2111.71,830.384 2112.07,827.123C2112.32,824.915 2061.55,764.151 2078.86,763.072C2131.79,759.773 2184.44,734.264 2204.82,707.029C2263.75,628.268 2362.66,579.917 2410.4,590.285C2444.26,597.638 2394.56,652.349 2386.42,698.248C2383.5,714.757 2374.56,728.774 2365.52,742.477Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2039.38,1027.23C2040.23,1032.24 2039.66,1037.68 2036.75,1041.83C2033.83,1045.99 2028.25,1048.45 2023.46,1046.78C2024.64,1049.81 2020.88,1052.35 2017.75,1053.22C2005.47,1056.63 1992,1055.59 1980.38,1050.34C1975.95,1048.34 1971.72,1045.69 1968.53,1042.01C1959.57,1031.67 1961.45,1014.33 1971.43,1004.96C1982.37,994.696 1997.44,995.394 2010.31,1000.88C2023.32,1006.44 2036.69,1011.26 2039.38,1027.23Z"
              style="fill: rgb(163, 127, 95); fill-rule: nonzero"
            />
            <path
              d="M2010.57,1029.14C2019.5,1031.06 2027.31,1038.05 2029.84,1046.82C2029.87,1046.94 2026.04,1047.51 2025.62,1047.49C2024.09,1047.45 2023.61,1047.32 2023.09,1046.01C2022.18,1043.75 2021.4,1041.5 2020.23,1039.35C2017.97,1035.18 2014.79,1031.41 2010.57,1029.14Z"
              style="fill: rgb(143, 113, 86); fill-rule: nonzero"
            />
            <path
              d="M2064.24,915.748C2058.55,931.875 2047.89,945.689 2037.46,959.234C2027.02,972.78 2016.45,986.686 2010.99,1002.89C2007.49,1013.27 2004.88,1025.97 1994.75,1030.17C1986.55,1033.56 1968.86,1038.79 1963.44,1031.76C1958.01,1024.72 1951.34,897.541 1957.31,847.864C1958.02,841.907 1958.9,835.807 1961.8,830.555C1966.21,822.559 1974.92,817.566 1983.91,815.924C1992.89,814.283 2002.17,815.623 2011.04,817.824C2023.45,820.907 2035.65,825.807 2045.45,834.029C2065.78,851.094 2072.8,891.469 2064.24,915.748Z"
              style="fill: rgb(163, 127, 95); fill-rule: nonzero"
            />
            <path
              d="M2520.79,654.555C2525.15,655.354 2525.22,656.481 2529.01,658.789C2532.8,661.095 2535.92,664.878 2536.43,669.287C2537.29,676.733 2530.87,682.873 2524.74,687.183C2514.58,694.319 2503.53,700.183 2491.92,704.592C2488.23,705.994 2484.36,707.268 2480.42,706.992C2471.87,706.393 2465.55,698.85 2461.39,691.359C2458.4,685.97 2455.91,680.104 2455.72,673.942C2455.33,661.3 2461.58,655.165 2472.82,654.55C2487.84,653.73 2505.71,651.796 2520.79,654.555Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2193.88,1009.67C2190.78,1021.33 2187.37,1033.55 2178.88,1042.12C2170.39,1050.69 2155.09,1053.77 2146.45,1045.35C2142.05,1041.06 2140.25,1034.83 2138.63,1028.9C2136.49,1021.1 2134.35,1013.29 2132.21,1005.49C2126.53,984.753 2120.81,963.747 2120.47,942.249C2120.13,920.75 2125.75,898.352 2140.23,882.454C2157.88,863.071 2222.03,845.453 2225.42,886.09C2226.9,903.796 2215.94,926.757 2211.45,943.639C2205.59,965.65 2199.74,987.662 2193.88,1009.67Z"
              style="fill: rgb(163, 127, 95); fill-rule: nonzero"
            />
            <path
              d="M2216.28,1028.97C2217.54,1033.89 2217.43,1039.36 2214.87,1043.74C2212.32,1048.12 2206.97,1051.04 2202.05,1049.79C2203.48,1052.7 2199.95,1055.55 2196.9,1056.68C2184.95,1061.11 2171.44,1061.2 2159.42,1056.95C2154.84,1055.32 2150.4,1053.04 2146.92,1049.64C2137.11,1040.08 2137.53,1022.65 2146.7,1012.48C2156.74,1001.33 2171.81,1000.76 2185.1,1005.15C2198.53,1009.59 2212.25,1013.29 2216.28,1028.97Z"
              style="fill: rgb(163, 127, 95); fill-rule: nonzero"
            />
            <path
              d="M2187.72,1033.29C2196.78,1034.45 2205.15,1040.76 2208.41,1049.29C2208.45,1049.4 2204.68,1050.29 2204.26,1050.32C2202.73,1050.4 2202.25,1050.31 2201.61,1049.04C2200.52,1046.87 2199.55,1044.69 2198.21,1042.65C2195.6,1038.69 2192.12,1035.19 2187.72,1033.29Z"
              style="fill: rgb(188, 184, 177); fill-rule: nonzero"
            />
            <path
              d="M2310.85,710.856C2301.46,753.617 2306.58,800.714 2325,840.992C2336.88,866.959 2354.39,890.328 2376.67,905.837C2398.95,921.346 2426.14,928.528 2451.28,923.012C2463.23,920.391 2522.58,917.981 2531.53,867.211C2533.02,858.758 2535.08,850.191 2534.95,841.381C2534.07,785.478 2500.47,735.93 2485.37,681.945C2474.39,642.701 2467.88,593.513 2423.16,587.469C2389.6,582.933 2354.36,621.712 2336.87,648.52C2324.75,667.113 2315.79,688.336 2310.85,710.856Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2291.24,892.478C2285.22,907.902 2278.26,923.2 2267.89,936.405C2243.18,967.846 2201.88,983.901 2161.12,991.374C2098.12,1002.93 2031.62,997.125 1971.89,974.865C1942.27,963.826 1912.89,947.51 1897.59,921.166C1888.7,905.859 1885.25,888.259 1883.9,870.864C1882.75,856.152 1883.06,841.09 1887.85,827.056C1898.83,794.92 1932.07,773.156 1966.79,764.903C2001.52,756.651 2038,759.632 2073.69,762.639C2109.37,765.646 2145.87,768.57 2180.57,760.211C2203.58,754.667 2224.97,744.333 2247.66,737.737C2262.34,733.472 2291.74,725.737 2305.83,735.08C2317.75,742.988 2315.36,763.269 2315.42,775.266C2315.59,815.342 2305.86,855.038 2291.24,892.478Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M1903.75,895.291C1919.05,921.635 1948.44,937.951 1978.06,948.991C2037.79,971.251 2104.28,977.052 2167.29,965.5C2208.04,958.026 2249.35,941.972 2274.05,910.53C2284.43,897.325 2278.37,923.201 2268,936.406C2243.29,967.847 2201.99,983.902 2161.23,991.375C2098.23,1002.93 2031.73,997.126 1972,974.867C1942.38,963.827 1913,947.511 1897.7,921.167C1888.81,905.86 1894.87,879.985 1903.75,895.291Z"
              style="fill: rgb(175, 137, 103); fill-rule: nonzero"
            />
            <path
              d="M2261.52,1045.59C2262.36,1050.59 2261.79,1056.03 2258.88,1060.19C2255.97,1064.34 2250.39,1066.8 2245.6,1065.13C2246.78,1068.16 2243.02,1070.7 2239.89,1071.57C2227.6,1074.98 2214.14,1073.94 2202.52,1068.7C2198.08,1066.69 2193.86,1064.04 2190.67,1060.37C2181.7,1050.02 2183.58,1032.68 2193.56,1023.32C2204.51,1013.05 2219.58,1013.75 2232.44,1019.24C2245.46,1024.79 2258.82,1029.62 2261.52,1045.59Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2232.7,1047.49C2241.63,1049.41 2249.44,1056.4 2251.98,1065.18C2252.01,1065.29 2248.17,1065.86 2247.75,1065.85C2246.22,1065.81 2245.75,1065.68 2245.22,1064.36C2244.32,1062.1 2243.54,1059.85 2242.37,1057.7C2240.1,1053.54 2236.93,1049.76 2232.7,1047.49Z"
              style="fill: rgb(172, 137, 106); fill-rule: nonzero"
            />
            <path
              d="M1962.8,1042.48C1963.64,1047.48 1963.07,1052.92 1960.16,1057.07C1957.25,1061.23 1951.67,1063.69 1946.88,1062.02C1948.06,1065.05 1944.3,1067.59 1941.16,1068.46C1928.88,1071.87 1915.41,1070.83 1903.8,1065.58C1899.36,1063.58 1895.13,1060.93 1891.94,1057.25C1882.98,1046.91 1884.86,1029.57 1894.84,1020.21C1905.78,1009.94 1920.85,1010.63 1933.72,1016.13C1946.74,1021.68 1960.1,1026.51 1962.8,1042.48Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M1933.98,1044.38C1942.91,1046.3 1950.72,1053.29 1953.25,1062.07C1953.29,1062.18 1949.45,1062.75 1949.03,1062.74C1947.5,1062.69 1947.03,1062.57 1946.5,1061.25C1945.6,1058.99 1944.81,1056.74 1943.64,1054.59C1941.38,1050.42 1938.21,1046.65 1933.98,1044.38Z"
              style="fill: rgb(172, 137, 106); fill-rule: nonzero"
            />
            <path
              d="M1880.53,730.109C1869.96,707.433 1869.72,681.467 1870.32,656.458C1867.89,654.229 1864.35,657.592 1862.93,660.577C1850.66,686.493 1849.7,716.308 1851.91,744.898C1853.32,763.218 1856.05,781.802 1864.13,798.3C1872.22,814.797 1886.43,829.1 1904.27,833.486C1922.11,837.873 1943.27,830.225 1951.14,813.624C1961.13,792.564 1946.41,776.266 1927.78,772.427C1906.82,768.108 1889.37,749.094 1880.53,730.109Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2531.53,867.211C2532.92,859.358 2534.79,851.406 2534.94,843.252C2521.96,830.3 2499.54,819.744 2485.01,820.428C2476.34,820.837 2467.36,826.128 2465.21,834.537C2461.64,848.438 2477.07,860.212 2478.73,874.467C2479.38,880.079 2477.83,885.682 2477.18,891.295C2476.52,896.907 2476.99,903.169 2480.86,907.283C2484.17,910.79 2489.21,911.958 2494,912.537C2510.93,905.132 2527.18,891.881 2531.53,867.211Z"
              style="fill: rgb(35, 31, 32); fill-rule: nonzero"
            />
            <path
              d="M2517.93,585.283C2519.63,582.658 2521.3,579.772 2521.21,576.643C2520.99,569.586 2507.32,549.651 2500.37,548.435C2476,544.176 2455.76,563.312 2432.83,572.58C2423.78,576.234 2414.57,581.464 2410.4,590.285C2406.46,598.633 2407.96,608.838 2412.6,616.817C2417.25,624.795 2424.67,630.812 2432.56,635.599C2448.73,645.4 2461.08,643.583 2474.75,631.625C2490.65,617.711 2506.33,603.113 2517.93,585.283Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2528.32,664.405C2529.39,668.693 2529.27,675.038 2528.1,679.298C2525.14,690.068 2520.29,698.958 2516.79,709.453C2516.57,710.111 2513.72,716.78 2518.28,720.778C2527.6,728.942 2545.8,714.109 2550.03,708.123C2553.56,703.133 2554.52,696.638 2553.6,690.595C2552.69,684.552 2550.05,678.895 2546.91,673.651C2543.87,668.574 2540.27,663.731 2535.59,660.106C2531.42,656.872 2526.13,654.485 2520.79,654.555C2524.41,655.636 2527.3,660.277 2528.32,664.405Z"
              style="fill: rgb(148, 113, 81); fill-rule: nonzero"
            />
            <path
              d="M2420,728.584C2408.52,724.558 2404,707.654 2409.9,690.831C2415.8,674.006 2429.89,663.632 2441.37,667.659C2452.85,671.686 2457.37,688.589 2451.47,705.413C2445.57,722.237 2431.48,732.611 2420,728.584Z"
              style="fill: white; fill-rule: nonzero"
            />
            <path
              d="M2440.79,720.315C2435.94,729.042 2426.56,733.089 2419.83,729.354C2413.1,725.618 2411.58,715.514 2416.43,706.786C2421.28,698.059 2430.66,694.012 2437.38,697.748C2444.11,701.483 2445.63,711.587 2440.79,720.315Z"
              style="fill: rgb(35, 31, 32); fill-rule: nonzero"
            />
            <path
              d="M2518.35,857.091C2517.38,857.091 2516.39,856.89 2515.47,856.576C2508.19,854.081 2503.29,845.447 2495.68,845.447C2495.58,845.447 2495.47,845.449 2495.37,845.452C2491.14,845.582 2487.01,848.512 2483.01,848.512C2482.15,848.512 2481.3,848.379 2480.46,848.055C2477.44,846.902 2475.7,843.449 2475.94,840.228C2476.31,834.898 2481.32,830.764 2486.58,829.829C2487.64,829.641 2488.7,829.556 2489.75,829.556C2493.98,829.556 2498.21,830.916 2502.14,832.585C2506.96,834.629 2533.03,847.914 2521.37,856.211C2520.49,856.839 2519.44,857.091 2518.35,857.091Z"
              style="fill: rgb(99, 94, 90); fill-rule: nonzero"
            />
            <path
              d="M2162.88,987.331C2157.65,986.238 2152.51,983.658 2149.55,979.383C2145.92,974.154 2146.13,967.394 2147.41,961.339C2149.92,949.51 2156.07,938.469 2164.92,929.923C2170.08,924.938 2177.19,920.565 2184.47,922.146C2189.43,923.225 2193.47,926.988 2195.72,931.351C2197.96,935.714 2198.63,940.632 2198.8,945.449C2199.08,953.524 2197.99,961.715 2194.64,969.066C2188.76,981.96 2177.99,990.484 2162.88,987.331Z"
              style="fill: rgb(175, 137, 103); fill-rule: nonzero"
            />
            <path
              d="M2240.82,1024.48C2236.75,1035.83 2232.32,1047.73 2223.15,1055.55C2213.97,1063.38 2198.46,1065.17 2190.56,1056.05C2186.53,1051.41 2185.27,1045.05 2184.15,1039.01C2182.67,1031.05 2181.2,1023.1 2179.72,1015.14C2175.8,994 2171.86,972.589 2173.32,951.137C2174.78,929.686 2182.26,907.837 2198.02,893.209C2217.23,875.374 2282.63,863.195 2282.61,903.974C2282.6,921.741 2269.75,943.702 2263.86,960.148C2256.18,981.592 2248.5,1003.04 2240.82,1024.48Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2003.56,957.528C2006.58,950.729 2006.26,943.305 2005.84,936.152C2005.3,926.996 2004.46,917.302 1998.44,910.137C1997.23,908.71 1995.71,907.345 1993.7,907.053C1990.74,906.622 1987.94,908.631 1985.64,910.501C1971.23,922.177 1956,935.434 1953.08,952.3C1952.53,955.495 1952.51,958.931 1954.34,961.599C1955.52,963.303 1957.35,964.542 1959.26,965.592C1972.77,973.046 1996.29,973.885 2003.56,957.528Z"
              style="fill: rgb(175, 137, 103); fill-rule: nonzero"
            />
            <path
              d="M1987.65,930.989C1981.96,947.116 1971.31,960.931 1960.87,974.476C1950.43,988.022 1939.87,1001.93 1934.4,1018.13C1930.9,1028.51 1928.29,1041.21 1918.17,1045.41C1909.96,1048.81 1892.28,1054.03 1886.85,1047C1881.42,1039.97 1874.75,912.783 1880.72,863.105C1881.43,857.148 1882.31,851.049 1885.21,845.796C1889.62,837.8 1898.33,832.808 1907.32,831.166C1916.3,829.524 1925.58,830.864 1934.45,833.066C1946.86,836.149 1959.06,841.048 1968.86,849.271C1989.19,866.335 1996.21,906.71 1987.65,930.989Z"
              style="fill: rgb(191, 148, 109); fill-rule: nonzero"
            />
            <path
              d="M2376.67,905.837C2376.67,905.837 2369.75,890.054 2366.57,872.25C2363,852.313 2364.8,837.148 2362.66,834.815C2360.52,832.483 2356.89,841.433 2356.47,865.008C2356.18,881.259 2360.99,892.932 2360.99,892.932C2360.99,892.932 2367.14,898.532 2370.37,901.143C2377.11,906.592 2376.67,905.837 2376.67,905.837Z"
              style="fill: rgb(35, 31, 32); fill-rule: nonzero"
            />
            <path
              d="M2315.58,819.566C2315.58,819.566 2306.75,786.913 2303.76,759.773C2300.77,732.634 2303.76,704.811 2303.76,704.811C2303.76,704.811 2288.02,724.388 2284.68,762.188C2281.34,799.989 2297.34,875.859 2297.34,875.859L2315.58,819.566Z"
              style="fill: rgb(175, 137, 103); fill-rule: nonzero"
            />
            <g transform="matrix(1,0,0,1,-0.505128,1.1696)">
              <path
                d="M2480.21,553.23C2492.28,557.612 2501.04,568.479 2506.1,580.278C2511.16,592.076 2513.06,604.936 2515.41,617.556C2516.29,622.264 2518.18,627.933 2522.9,628.706C2527.07,629.388 2530.62,625.623 2532.59,621.889C2537.96,611.763 2538.14,599.723 2537.2,588.303C2536.17,575.794 2533.48,562.468 2524.42,553.785C2516.71,546.393 2505.4,543.637 2494.74,544.412C2488.92,544.835 2477.14,546.247 2473.54,551.166C2475.4,552.242 2478.01,552.43 2480.21,553.23Z"
                style="fill: rgb(148, 113, 81); fill-rule: nonzero"
              />
            </g>
          </g>
        </g>

        <g ref="dirtLayer">
          <polygon
            v-for="dirt in dirtPositions"
            :key="dirt.id"
            :points="dirt.points"
            fill="#813a00"
          />
        </g>
        <g ref="bubblesLayer"></g>
        <g ref="waterDropLayer"></g>
      </g>
    </svg>
    <img
      v-if="currentState !== 'gameCompleted'"
      ref="toolElement"
      :src="toolImage"
      draggable="false"
      :style="{ height: '100px', left: toolPosition.x + 'px', top: toolPosition.y + 'px' }"
      class="tool"
      @mousedown="startAction"
      @mousemove="performAction"
      @mouseup="stopAction"
      @touchstart.prevent="startAction"
      @touchmove.prevent="performAction"
      @touchend="stopAction"
      @touchcancel="stopAction"
    />
  </div>
</template>

<script lang="ts" setup>
import { computed, ref, watch } from 'vue'
import { useCareTimeBubbles } from '@/composables/useCareTimeBubbles'
import { useCareTimeToolStore } from '@/stores/careTimeToolStore'
import { useSound } from '@/composables/sound'
import waterSound from '@/assets/audio/soundEffects/water.mp3'
import dryerSound from '@/assets/audio/soundEffects/dryer.mp3'
import { storeToRefs } from 'pinia'
import { useMascotStore } from '@/stores/useMascotStore'
import imgShampoo from '@/assets/shampoo.svg'
import imgShowerHead from '@/assets/Showerhead_water.svg'
import imgTowel from '@/assets/Towel.svg'

const emit = defineEmits(['bubbleCounter', 'waterDropCounter'])

defineProps<{
  width: number
  height: number
}>()

const mascot = useMascotStore()
const { currentState } = storeToRefs(useCareTimeToolStore())
const sound = useSound()

const svgElement = ref<SVGSVGElement | null>(null)
const toolElement = ref<HTMLImageElement | null>(null)

const toolImage = computed(() =>
  currentState.value === 'showering'
    ? imgShowerHead
    : currentState.value === 'drying'
      ? imgTowel
      : imgShampoo
)

const {
  dogPath,
  isPointInDog,
  bubblesLayer,
  bubblePositions,
  createBubble,
  removeBubbles,
  dirtLayer,
  dirtPositions,
  removeDirt,
  createWaterDrop,
  removeWaterDrops,
  waterDropLayer,
  waterDropPositions
} = useCareTimeBubbles()
const isActionActive = ref(false)
const toolPosition = ref({ x: window.innerWidth - 150, y: 150 })

const getTransformedCoordinates = (event: MouseEvent | TouchEvent, svgElement: SVGSVGElement) => {
  const point = svgElement.createSVGPoint()
  if (event instanceof MouseEvent) {
    point.x = event.clientX
    point.y = event.clientY
  } else {
    const touch = event.touches[0]
    point.x = touch.clientX
    point.y = touch.clientY
  }
  const transformedPoint = point.matrixTransform(svgElement.getScreenCTM()?.inverse())
  return {
    originalX: point.x,
    originalY: point.y,
    transformedX: transformedPoint.x,
    transformedY: transformedPoint.y
  }
}

const startAction = (event: MouseEvent | TouchEvent) => {
  isActionActive.value = true
  mascot.hideSpeechBubble()
  performSound()
  performAction(event)
}

const performAction = (event: MouseEvent | TouchEvent) => {
  if (!isActionActive.value) return

  if (svgElement.value && dogPath.value) {
    const { originalX, originalY, transformedX, transformedY } = getTransformedCoordinates(
      event,
      svgElement.value
    )

    if (toolElement.value) {
      const toolRect = toolElement.value.getBoundingClientRect()
      toolPosition.value = { x: originalX - toolRect.width / 2, y: originalY - toolRect.height / 2 }
    }

    if (currentState.value === 'shampooing') {
      if (isPointInDog(transformedX, transformedY)) {
        createBubble(transformedX, transformedY)
        emit('bubbleCounter', bubblePositions.value.length)
      }
    } else if (currentState.value === 'showering') {
      removeBubbles(transformedX, transformedY)
      emit('bubbleCounter', bubblePositions.value.length)
      removeDirt(transformedX, transformedY)
      if (isPointInDog(transformedX, transformedY)) {
        createWaterDrop(transformedX, transformedY)
        emit('waterDropCounter', waterDropPositions.value.length)
      }
    } else if (currentState.value === 'drying') {
      removeWaterDrops(transformedX, transformedY)
      emit('waterDropCounter', waterDropPositions.value.length)
    }
  }
}

const performSound = () => {
  if (!isActionActive.value) return
  if (currentState.value === 'showering') {
    sound.playLoop(waterSound)
  } else if (currentState.value === 'drying') {
    sound.playLoop(dryerSound)
  }
}

watch(
  () => [bubblePositions.value, waterDropPositions.value, currentState.value],
  ([bubbles, waterDrops, currState]) => {
    if (bubbles.length === 0 && currState === 'shampooing') {
      // Do nothing - Game just started
    } else if (bubbles.length === 0 && currState === 'showering') {
      // All bubbles showered off
      mascot.showMessage('STAGE4_IS_SHOWERED')
      currentState.value = 'drying'
      isActionActive.value = false
    } else if (bubbles.length === 100 && currState === 'shampooing') {
      // Fully shampooed dog => now switch to shower
      mascot.showMessage('STAGE4_IS_SHAMPOOED')
      currentState.value = 'showering'
      isActionActive.value = false
    } else if (waterDrops.length === 0 && currState === 'drying') {
      mascot.showMessage('STAGE4_WASHING_DONE')
      currentState.value = 'gameCompleted'
      isActionActive.value = false
    } else if (currState === 'gameCompleted') {
      //
    }
  },
  { deep: true }
)

const stopAction = () => {
  isActionActive.value = false
  sound.stopLoop()
}
</script>

<style>
.tool {
  position: absolute;
}
</style>
